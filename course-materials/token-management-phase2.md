# Token 管理机制 - Phase 2 实施记录

## 实施日期
2026-02-14

## 实施内容

### ✅ 已完成

**定时提醒设置** - 每4小时提醒检查 Token 使用情况

```
任务名称: Token检查-每20轮对话
执行频率: 每4小时 (0 */4 * * *)
时区: Asia/Shanghai
下次执行: 根据当前时间计算
```

**提醒内容**:
- 建议执行 `/status` 查看使用情况
- 提示约 20 轮对话后执行 `/compact`

### 设计思路

**为什么不预估 Token？**
1. 精确计算需要调用模型官方的 Tokenizer
2. 估算可能不准确，反而误导用户
3. 基于对话轮数的提醒更直观易懂

**为什么是每4小时？**
- 假设用户活跃时段每天约 8-12 小时
- 每4小时提醒 ≈ 每天 2-3 次
- 既不会过于频繁，又能及时提醒

**为什么是20轮？**
- 根据 AGENTS.md 最佳实践建议
- 20-30 轮是 Token 开始累积的临界点
- 用户可根据实际情况灵活调整

## 任务管理

**查看任务**:
```bash
openclaw cron list
```

**删除任务**:
```bash
openclaw cron remove --id 45e28846-1bbe-4c76-9112-f87a24553f0c
```

## 下一步（Phase 3）

网关层完整实现（1个月内）:
1. 网关集成 Token 管理器
2. 调用官方 Tokenizer 精确计算
3. 支持模型特定的策略配置

## 备注

Phase 2 采用轻量级方案，通过定时提醒引导用户主动管理 Token。
避免了复杂的客户端 Token 估算逻辑，简单有效。
